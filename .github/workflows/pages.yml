name: Deploy GitHub Pages

on:
  push:
    branches: [ main ]
    paths:
      - 'docs/**'
      - 'README.md'
      - 'resources/**'
      - 'examples/**'
      - '.github/workflows/pages.yml'

  # å…è®¸æ‰‹åŠ¨è§¦å‘
  workflow_dispatch:

# è®¾ç½® GITHUB_TOKEN çš„æƒé™ä»¥å…è®¸éƒ¨ç½²åˆ° GitHub Pages
permissions:
  contents: read
  pages: write
  id-token: write

# åªå…è®¸ä¸€ä¸ªå¹¶å‘éƒ¨ç½²ï¼Œè·³è¿‡æ­£åœ¨è¿è¡Œå’Œæœ€æ–°æŽ’é˜Ÿçš„è¿è¡Œä¹‹é—´çš„è¿è¡Œ
concurrency:
  group: "pages"
  cancel-in-progress: false

jobs:
  # æž„å»ºä½œä¸š
  build:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v4
        
      - name: Setup Node.js
        uses: actions/setup-node@v6
        with:
          node-version: '18'
          
      - name: Install dependencies
        run: |
          npm install -g @vuepress/cli vuepress
          
      - name: Setup VuePress config
        run: |
          mkdir -p .vuepress
          cat > .vuepress/config.js << 'EOF'
          module.exports = {
            title: 'Git æ•™ç¨‹ - ä»Žå…¥é—¨åˆ°ç²¾é€š',
            description: 'ç»¼åˆæ€§çš„ Git æ•™ç¨‹ï¼ŒåŒ…å«å®Œæ•´çš„å­¦ä¹ è·¯å¾„ã€å®žè·µç»ƒä¹ å’Œç¤ºä¾‹é¡¹ç›®',
            base: '/git-tutorial/',
            head: [
              ['link', { rel: 'icon', href: '/favicon.ico' }]
            ],
            themeConfig: {
              nav: [
                { text: 'é¦–é¡µ', link: '/' },
                { text: 'æ•™ç¨‹', link: '/docs/' },
                { text: 'ç»ƒä¹ ', link: '/exercises/' },
                { text: 'ç¤ºä¾‹', link: '/examples/' },
                { text: 'èµ„æº', link: '/resources/' },
                { text: 'GitHub', link: 'https://github.com/1304674612/git-tutorial' }
              ],
              sidebar: {
                '/docs/': [
                  {
                    title: 'Git æ•™ç¨‹',
                    collapsable: false,
                    children: [
                      '',
                      '01-git-basics',
                      '02-basic-operations',
                      'github-automation-tools'
                    ]
                  }
                ],
                '/exercises/': [
                  {
                    title: 'å®žè·µç»ƒä¹ ',
                    collapsable: false,
                    children: [
                      'basic/'
                    ]
                  }
                ],
                '/examples/': [
                  {
                    title: 'ç¤ºä¾‹é¡¹ç›®',
                    collapsable: false,
                    children: [
                      'simple-project/'
                    ]
                  }
                ],
                '/resources/': [
                  {
                    title: 'å­¦ä¹ èµ„æº',
                    collapsable: false,
                    children: [
                      'cheat-sheet'
                    ]
                  }
                ]
              },
              lastUpdated: 'æœ€åŽæ›´æ–°',
              repo: '1304674612/git-tutorial',
              editLinks: true,
              editLinkText: 'åœ¨ GitHub ä¸Šç¼–è¾‘æ­¤é¡µ',
              docsDir: '',
              docsBranch: 'main'
            },
            plugins: [
              '@vuepress/back-to-top',
              '@vuepress/medium-zoom',
              [
                '@vuepress/google-analytics',
                {
                  ga: 'G-XXXXXXXXXX' // æ›¿æ¢ä¸ºå®žé™…çš„ Google Analytics ID
                }
              ]
            ]
          }
          EOF
          
      - name: Create docs index
        run: |
          cat > docs/README.md << 'EOF'
          # Git æ•™ç¨‹æ–‡æ¡£
          
          æ¬¢è¿Žæ¥åˆ° Git æ•™ç¨‹æ–‡æ¡£ï¼è¿™é‡ŒåŒ…å«äº†å®Œæ•´çš„ Git å­¦ä¹ èµ„æ–™ã€‚
          
          ## ðŸ“š æ•™ç¨‹å†…å®¹
          
          - [Git åŸºç¡€](01-git-basics.md) - äº†è§£ Git çš„åŸºæœ¬æ¦‚å¿µ
          - [åŸºæœ¬æ“ä½œ](02-basic-operations.md) - æŽŒæ¡å¸¸ç”¨çš„ Git å‘½ä»¤
          - [GitHub è‡ªåŠ¨åŒ–å·¥å…·](github-automation-tools.md) - æå‡å¼€å‘æ•ˆçŽ‡çš„å·¥å…·æŽ¨è
          
          ## ðŸš€ å¼€å§‹å­¦ä¹ 
          
          å»ºè®®æŒ‰ç…§ä»¥ä¸‹é¡ºåºè¿›è¡Œå­¦ä¹ ï¼š
          
          1. å…ˆé˜…è¯» [Git åŸºç¡€](01-git-basics.md) äº†è§£åŸºæœ¬æ¦‚å¿µ
          2. é€šè¿‡ [åŸºæœ¬æ“ä½œ](02-basic-operations.md) æŽŒæ¡å¸¸ç”¨å‘½ä»¤
          3. å®Œæˆ [åŸºç¡€ç»ƒä¹ ](/exercises/basic/) å·©å›ºçŸ¥è¯†
          4. æŸ¥çœ‹ [ç¤ºä¾‹é¡¹ç›®](/examples/simple-project/) äº†è§£å®žé™…åº”ç”¨
          
          ## ðŸ“‹ å­¦ä¹ èµ„æº
          
          - [Git é€ŸæŸ¥è¡¨](/resources/cheat-sheet.md) - å¿«é€ŸæŸ¥æ‰¾å¸¸ç”¨å‘½ä»¤
          - [GitHub è‡ªåŠ¨åŒ–å·¥å…·](github-automation-tools.md) - æå‡å·¥ä½œæ•ˆçŽ‡
          EOF
          
      - name: Build VuePress site
        run: |
          vuepress build . --dest dist
          
      - name: Setup Pages
        uses: actions/configure-pages@v4
        
      - name: Upload artifact
        uses: actions/upload-pages-artifact@v3
        with:
          path: ./dist

  # éƒ¨ç½²ä½œä¸š
  deploy:
    environment:
      name: github-pages
      url: ${{ steps.deployment.outputs.page_url }}
    runs-on: ubuntu-latest
    needs: build
    steps:
      - name: Deploy to GitHub Pages
        id: deployment
        uses: actions/deploy-pages@v4