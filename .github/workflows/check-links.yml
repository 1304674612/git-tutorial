name: Check Documentation Links

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]
  schedule:
    # 每周检查一次链接
    - cron: '0 0 * * 0'

jobs:
  check-links:
    runs-on: ubuntu-latest
    steps:
    - uses: actions/checkout@v5
    
    - name: Check links in documentation
      uses: lycheeverse/lychee-action@v1
      with:
        args: --verbose --no-progress './**/*.md'
        fail: true
      env:
        GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
    
    - name: Create issue on link failure
      if: failure()
      uses: actions/github-script@v7
      with:
        script: |
          github.rest.issues.create({
            owner: context.repo.owner,
            repo: context.repo.repo,
            title: '📎 发现失效链接 - Broken Links Detected',
            body: '自动检测发现文档中存在失效链接，请检查并修复。\n\nAutomatic link checking found broken links in documentation. Please review and fix.',
            labels: ['bug', 'documentation']
          })